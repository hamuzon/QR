<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Minecraft-QR-Generator</title>
<meta name="description" content="MinecraftのQR建築に最適なQRコードを生成します。黒と白のコンクリートでマイクラ風に表現。">
<meta name="keywords" content="Minecraft, QRコード, QR, コンクリート, マイクラ, 建築, QR generator, MC QR">
<style>
body{margin:0;font-family:'Inter',sans-serif;display:flex;justify-content:center;align-items:flex-start;min-height:100vh;background:linear-gradient(180deg,#f9e6e7 0%,#fce8d8 30%,#d9f0e6 70%,#a8d0e6 100%);padding:1rem;color:#333;}
main.container{background:rgba(255,255,255,0.85);backdrop-filter:blur(10px);border-radius:1.5rem;width:100%;max-width:90vw;padding:2rem;text-align:center;box-shadow:0 8px 24px rgba(0,0,0,0.1);}
h1{font-size:2rem;margin-bottom:1rem;}
input[type="text"]{padding:0.5rem;font-size:1rem;border:2px solid #3399ff;border-radius:10px;outline:none;text-align:center;transition:0.3s;width:90%;}
input:focus{border-color:#7fbfff;}
#buttonGroup{display:flex;flex-wrap:wrap;justify-content:center;margin:0.5rem 0;}
button{flex:1;padding:0.6rem 1rem;margin:0.2rem;border:none;border-radius:14px;background:#3399ff;color:#fff;font-weight:bold;cursor:pointer;transition:0.3s;min-width:120px;}
button:hover{background:#7fbfff;}
#blockqr{margin-top:1rem;width:100%;height:auto;border:2px solid #555;image-rendering:pixelated;}
footer{margin-top:1.5rem;font-size:0.75rem;color:#666;}
footer a{color:#3399ff;text-decoration:none;}
footer a:hover{text-decoration:underline;}
@media(max-width:480px){#buttonGroup{flex-direction:column;}button{width:100%;}}
</style>
</head>
<body>
<main class="container">
<h1>Minecraft-QR-Generator</h1>
<input type="text" id="inputText" placeholder="URL または テキストを入力">
<div id="buttonGroup">
<button onclick="generateMCQR()">Generate QR</button>
<button onclick="downloadMCQR()">Download PNG</button>
</div>
<canvas id="blockqr"></canvas>
<footer id="footer-copy">&copy; 2025–<span id="year"></span> <a href="https://github.com/soldair/node-qrcode" target="_blank">QRCode.js</a></footer>
</main>

<script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.1/build/qrcode.min.js"></script>
<script>
document.getElementById("year").textContent=new Date().getFullYear();
let lastText="";
async function generateMCQR(){
  let text=document.getElementById("inputText").value.trim();
  if(!text){alert("⚠️ 入力が空です");return;}
  text+="\n©2025–"+new Date().getFullYear();
  lastText=text;

  const tempCanvas=document.createElement("canvas");
  await QRCode.toCanvas(tempCanvas,text,{width:0,margin:1});
  const modules=tempCanvas.width;

  // ブラウザ幅に応じてキャンバスサイズ決定
  const containerWidth=document.querySelector('main.container').clientWidth;
  const canvasSize=Math.floor(containerWidth*0.95);
  const cellSize=Math.floor(canvasSize/modules);

  const finalSize=cellSize*modules;

  const canvas=document.getElementById("blockqr");
  canvas.width=finalSize;
  canvas.height=finalSize;
  const ctx=canvas.getContext("2d");

  const ctxTemp=tempCanvas.getContext("2d");
  const data=ctxTemp.getImageData(0,0,tempCanvas.width,tempCanvas.height).data;

  for(let y=0;y<modules;y++){
    for(let x=0;x<modules;x++){
      const i=(y*modules+x)*4;
      const brightness=(data[i]+data[i+1]+data[i+2])/3;
      ctx.fillStyle=brightness<128?"#1D1D21":"#F9FFFE";
      ctx.fillRect(x*cellSize,y*cellSize,cellSize,cellSize);
      ctx.strokeStyle="#555";
      ctx.strokeRect(x*cellSize,y*cellSize,cellSize,cellSize);
    }
  }
}

function downloadMCQR(){
  const canvas=document.getElementById("blockqr");
  if(!canvas.width){alert("QRコードを生成してください");return;}
  const link=document.createElement("a");
  link.download="Minecraft-QR.png";
  link.href=canvas.toDataURL("image/png");
  link.click();
}

// ウィンドウリサイズ時に自動再生成
window.addEventListener('resize',()=>{if(lastText){generateMCQR();}});
</script>
</body>
</html>
